# OAuth å‰ç«¯æ¥å…¥æ€»ç»“

## ğŸ“¦ å·²åˆ›å»ºçš„æ–‡ä»¶

### æ ¸å¿ƒåŠŸèƒ½æ–‡ä»¶
1. **`frontend/app/(auth)/callback/page.tsx`**
   - OAuth å›è°ƒå¤„ç†é¡µé¢
   - è‡ªåŠ¨æå– code å’Œ state
   - è°ƒç”¨åç«¯ API éªŒè¯
   - å­˜å‚¨ token å’Œç”¨æˆ·ä¿¡æ¯
   - å¤„ç†æˆåŠŸ/å¤±è´¥çŠ¶æ€
   - è‡ªåŠ¨è·³è½¬

2. **`frontend/lib/auth/oauth-redirect.ts`**
   - é‡å®šå‘åœ°å€ç®¡ç†å·¥å…·
   - ä¿å­˜/è·å–/æ¸…é™¤é‡å®šå‘åœ°å€
   - ä½¿ç”¨ sessionStorage å­˜å‚¨

3. **`frontend/components/auth/oauth-buttons.tsx`**
   - LinuxDo OAuth ç™»å½•æŒ‰é’®ç»„ä»¶
   - å¯é…ç½®é‡å®šå‘åœ°å€
   - å¯é€‰åˆ†éš”çº¿æ˜¾ç¤º
   - å“åº”å¼è®¾è®¡

### å›½é™…åŒ–æ–‡æ¡ˆ
4. **æ›´æ–°äº† `frontend/lib/i18n/auth.ts`**
   - æ·»åŠ äº† OAuth ç›¸å…³çš„ä¸­è‹±æ–‡æ–‡æ¡ˆ
   - `auth.oauth_processing`: "æ­£åœ¨å¤„ç† OAuth ç™»å½•..."
   - `auth.oauth_success`: "ç™»å½•æˆåŠŸï¼"
   - `auth.oauth_failed`: "OAuth ç™»å½•å¤±è´¥"
   - `auth.oauth_linuxdo`: "ä½¿ç”¨ LinuxDo ç»§ç»­"
   - ç­‰ç­‰...

### æ–‡æ¡£
5. **`docs/frontend/oauth-integration.md`**
   - OAuth é›†æˆå®Œæ•´æŒ‡å—
   - æµç¨‹è¯´æ˜ã€API è¦æ±‚ã€å®‰å…¨è€ƒè™‘

6. **`docs/frontend/oauth-integration-example.md`**
   - é›†æˆç¤ºä¾‹ä»£ç 
   - è‡ªå®šä¹‰æŒ‰é’®ã€é”™è¯¯å¤„ç†

7. **`docs/frontend/oauth-linuxdo-integration.md`**
   - LinuxDo OAuth ä¸“ç”¨æ¥å…¥æ–¹æ¡ˆ
   - åç«¯ API åˆ†æ
   - å®Œæ•´æµç¨‹å›¾

8. **`docs/frontend/oauth-quick-start.md`**
   - å¿«é€Ÿæ¥å…¥æŒ‡å—
   - æµ‹è¯•æ¸…å•
   - å¸¸è§é—®é¢˜

9. **`docs/frontend/oauth-setup-summary.md`**
   - è®¾ç½®æ€»ç»“
   - é…ç½®è¦æ±‚
   - åç«¯ API è§„èŒƒ

## âœ… åç«¯å·²å®ç°çš„ API

### 1. æˆæƒç«¯ç‚¹
```
GET /auth/oauth/linuxdo/authorize
```
- ç”Ÿæˆ state å¹¶å­˜å‚¨åˆ° Redisï¼ˆ5åˆ†é’Ÿæœ‰æ•ˆï¼‰
- æ„å»º LinuxDo æˆæƒ URL
- 307 é‡å®šå‘åˆ° LinuxDo

### 2. å›è°ƒéªŒè¯ç«¯ç‚¹
```
POST /auth/oauth/callback
Content-Type: application/json

{
  "code": "authorization_code",
  "state": "state_value"
}
```

**å“åº”**:
```json
{
  "access_token": "xxx",
  "refresh_token": "xxx",
  "token_type": "bearer",
  "expires_in": 3600,
  "user": {
    "id": 1,
    "email": "user@example.com",
    "display_name": "User Name",
    "is_active": true,
    "avatar_url": "https://...",
    "role": "user"
  }
}
```

## ğŸ¯ å‰ç«¯æ¥å…¥åªéœ€ 1 æ­¥

åœ¨ `frontend/components/auth/auth-dialog.tsx` ä¸­æ·»åŠ ä¸€è¡Œä»£ç ï¼š

```tsx
import { OAuthButtons } from "@/components/auth/oauth-buttons";

export function AuthDialog() {
  return (
    <Dialog open={isAuthDialogOpen} onOpenChange={closeAuthDialog}>
      <DialogContent>
        <DialogHeader>
          {/* ... */}
        </DialogHeader>

        {/* ğŸ‘‡ æ·»åŠ è¿™ä¸€è¡Œå³å¯ */}
        <OAuthButtons redirectUrl={redirectTo} />

        <BrushBorder>
          {/* ç°æœ‰çš„é‚®ç®±å¯†ç ç™»å½•è¡¨å• */}
        </BrushBorder>
      </DialogContent>
    </Dialog>
  );
}
```

## ğŸ”§ é…ç½®è¦æ±‚

### åç«¯ç¯å¢ƒå˜é‡ (`.env`)
```env
LINUXDO_OAUTH_ENABLED=true
LINUXDO_CLIENT_ID=ä½ çš„_client_id
LINUXDO_CLIENT_SECRET=ä½ çš„_client_secret
LINUXDO_REDIRECT_URI=https://ai.ethereals.space/callback
```

### å‰ç«¯ç¯å¢ƒå˜é‡ (`.env.local`)
```env
NEXT_PUBLIC_API_BASE_URL=http://localhost:8000
```

### LinuxDo åº”ç”¨é…ç½®
- **å›è°ƒåœ°å€**: `https://ai.ethereals.space/callback`
- **å¼€å‘ç¯å¢ƒ**: `http://localhost:3000/callback`

## ğŸš€ å®Œæ•´æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»"ä½¿ç”¨ LinuxDo ç»§ç»­"
   â†“
2. å‰ç«¯ä¿å­˜å½“å‰é¡µé¢åœ°å€ (sessionStorage)
   â†“
3. è·³è½¬åˆ° /auth/oauth/linuxdo/authorize
   â†“
4. åç«¯ç”Ÿæˆ state å­˜å‚¨åˆ° Redis
   â†“
5. åç«¯é‡å®šå‘åˆ° LinuxDo æˆæƒé¡µé¢
   â†“
6. ç”¨æˆ·åœ¨ LinuxDo æˆæƒ
   â†“
7. LinuxDo å›è°ƒåˆ° /callback?code=xxx&state=xxx
   â†“
8. å‰ç«¯å›è°ƒé¡µé¢æå–å‚æ•°
   â†“
9. è°ƒç”¨ POST /auth/oauth/callback
   â†“
10. åç«¯éªŒè¯ stateã€è·å– tokenã€åŒæ­¥ç”¨æˆ·
    â†“
11. è¿”å› access_token + refresh_token + user
    â†“
12. å‰ç«¯å­˜å‚¨ token (localStorage + Cookie)
    â†“
13. æ›´æ–°ç”¨æˆ·çŠ¶æ€ (auth store)
    â†“
14. è·³è½¬åˆ°ç›®æ ‡é¡µé¢
```

## ğŸ¨ UI æ•ˆæœ

### ç™»å½•å¯¹è¯æ¡†
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      AI ç»ˆç½‘å…³                   â”‚
â”‚      ç™»å½•åˆ°ä½ çš„è´¦æˆ·              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ”’ ä½¿ç”¨ LinuxDo ç»§ç»­     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€ æˆ–ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ç»§ç»­ â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  é‚®ç®±                      â”‚ â”‚
â”‚  â”‚  [name@example.com]       â”‚ â”‚
â”‚  â”‚                           â”‚ â”‚
â”‚  â”‚  å¯†ç                       â”‚ â”‚
â”‚  â”‚  [â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢]               â”‚ â”‚
â”‚  â”‚                           â”‚ â”‚
â”‚  â”‚  â˜‘ è®°ä½æˆ‘    å¿˜è®°å¯†ç ï¼Ÿ    â”‚ â”‚
â”‚  â”‚                           â”‚ â”‚
â”‚  â”‚  [ ç™»å½• ]                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚  è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ ç«‹å³æ³¨å†Œ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å›è°ƒé¡µé¢ï¼ˆå¤„ç†ä¸­ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚         âŸ³ (æ—‹è½¬åŠ¨ç”»)            â”‚
â”‚                                 â”‚
â”‚    æ­£åœ¨å¤„ç† OAuth ç™»å½•...        â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å›è°ƒé¡µé¢ï¼ˆæˆåŠŸï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚         âœ“ (ç»¿è‰²å‹¾å·)            â”‚
â”‚                                 â”‚
â”‚         ç™»å½•æˆåŠŸï¼               â”‚
â”‚    æ­£åœ¨è·³è½¬åˆ°ä»ªè¡¨ç›˜...           â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å›è°ƒé¡µé¢ï¼ˆå¤±è´¥ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚         âœ— (çº¢è‰²å‰å·)            â”‚
â”‚                                 â”‚
â”‚      OAuth ç™»å½•å¤±è´¥              â”‚
â”‚      [é”™è¯¯è¯¦æƒ…]                  â”‚
â”‚    æ­£åœ¨è·³è½¬åˆ°ç™»å½•é¡µ...           â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§ª æµ‹è¯•æ¸…å•

### æ­£å¸¸æµç¨‹
- [ ] ç‚¹å‡»æŒ‰é’®èƒ½è·³è½¬åˆ° LinuxDo
- [ ] æˆæƒåèƒ½å›è°ƒåˆ° /callback
- [ ] æ˜¾ç¤º"æ­£åœ¨å¤„ç†"çŠ¶æ€
- [ ] ç™»å½•æˆåŠŸæ˜¾ç¤ºç»¿è‰²å‹¾å·
- [ ] èƒ½è·³è½¬åˆ°ç›®æ ‡é¡µé¢
- [ ] ç”¨æˆ·ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º
- [ ] åˆ·æ–°åä»ä¿æŒç™»å½•

### é”™è¯¯å¤„ç†
- [ ] å–æ¶ˆæˆæƒæ˜¾ç¤ºé”™è¯¯
- [ ] State è¿‡æœŸæ˜¾ç¤ºé”™è¯¯
- [ ] ç½‘ç»œé”™è¯¯æ˜¾ç¤ºé‡è¯•
- [ ] åç«¯æœªé…ç½®æ˜¾ç¤ºå‹å¥½æç¤º

### è¾¹ç•Œæƒ…å†µ
- [ ] é‡å¤ä½¿ç”¨ code è¢«æ‹’ç»
- [ ] æ— æ•ˆ state è¢«æ‹’ç»
- [ ] Token æ­£ç¡®å­˜å‚¨
- [ ] é‡å®šå‘åœ°å€æ­£ç¡®æ¢å¤

## ğŸ“Š æŠ€æœ¯æ ˆ

### å‰ç«¯
- Next.js 14 (App Router)
- TypeScript
- Tailwind CSS
- shadcn/ui
- Zustand (çŠ¶æ€ç®¡ç†)
- js-cookie (Cookie ç®¡ç†)

### åç«¯
- FastAPI
- Redis (state å­˜å‚¨)
- PostgreSQL (ç”¨æˆ·æ•°æ®)
- httpx (HTTP å®¢æˆ·ç«¯)

## ğŸ”’ å®‰å…¨ç‰¹æ€§

1. **State å‚æ•°** - é˜²æ­¢ CSRF æ”»å‡»
2. **5åˆ†é’Ÿè¿‡æœŸ** - State è‡ªåŠ¨å¤±æ•ˆ
3. **ä¸€æ¬¡æ€§ä½¿ç”¨** - Code å’Œ State åªèƒ½ç”¨ä¸€æ¬¡
4. **HTTPS** - ç”Ÿäº§ç¯å¢ƒå¼ºåˆ¶ HTTPS
5. **Token åˆ†ç¦»** - Access token å’Œ Refresh token åˆ†å¼€å­˜å‚¨
6. **HttpOnly Cookie** - Refresh token ä½¿ç”¨ HttpOnly Cookie

## ğŸ‰ å®ŒæˆçŠ¶æ€

### âœ… å·²å®Œæˆ
- [x] å›è°ƒé¡µé¢å®ç°
- [x] é‡å®šå‘ç®¡ç†å·¥å…·
- [x] OAuth æŒ‰é’®ç»„ä»¶
- [x] å›½é™…åŒ–æ–‡æ¡ˆ
- [x] å®Œæ•´æ–‡æ¡£
- [x] é”™è¯¯å¤„ç†
- [x] çŠ¶æ€æ˜¾ç¤º
- [x] Token å­˜å‚¨
- [x] ç”¨æˆ·çŠ¶æ€æ›´æ–°

### ğŸ“ å¾…å®Œæˆ
- [ ] åœ¨ç™»å½•å¯¹è¯æ¡†ä¸­é›†æˆï¼ˆåªéœ€1è¡Œä»£ç ï¼‰
- [ ] é…ç½®ç¯å¢ƒå˜é‡
- [ ] æµ‹è¯•å®Œæ•´æµç¨‹

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹](./oauth-quick-start.md) - æœ€å¿«æ¥å…¥æ–¹å¼
- [LinuxDo æ¥å…¥](./oauth-linuxdo-integration.md) - è¯¦ç»†æŠ€æœ¯æ–¹æ¡ˆ
- [é›†æˆæŒ‡å—](./oauth-integration.md) - é€šç”¨ OAuth æŒ‡å—
- [é›†æˆç¤ºä¾‹](./oauth-integration-example.md) - ä»£ç ç¤ºä¾‹
- [è®¾ç½®æ€»ç»“](./oauth-setup-summary.md) - é…ç½®æ¸…å•

## ğŸ’¡ æç¤º

æ‰€æœ‰æ ¸å¿ƒä»£ç å·²ç»å‡†å¤‡å¥½ï¼Œå‰ç«¯æ¥å…¥åªéœ€è¦ï¼š

1. åœ¨ç™»å½•å¯¹è¯æ¡†ä¸­æ·»åŠ  `<OAuthButtons />` ç»„ä»¶
2. é…ç½®åç«¯ç¯å¢ƒå˜é‡
3. åœ¨ LinuxDo é…ç½®å›è°ƒåœ°å€
4. æµ‹è¯•ç™»å½•æµç¨‹

å°±è¿™ä¹ˆç®€å•ï¼ğŸŠ
